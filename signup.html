<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coordinator Sign-Up - Brain-O-Math Olympiad</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Register as the Brain-O-Math Coordinator for your school to manage student participation.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --success: #10b981;
      --error: #ef4444;
      --white: #ffffff;
      --gray-50: #f8fafc;
      --gray-100: #f1f5f9;
      --gray-200: #e2e8f0;
      --gray-300: #cbd5e1;
      --gray-400: #94a3b8;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1e293b;
      --gray-900: #0f172a;
      --radius-lg: 0.5rem;
      --radius-xl: 0.75rem;
      --radius-2xl: 1rem;
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      color: var(--gray-800);
    }

    .signup-container {
      width: 100%;
      max-width: 500px;
      background: var(--white);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
      position: relative;
    }

    .signup-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
    }

    .signup-header {
      text-align: center;
      padding: 2rem 2rem 1.5rem;
      background: var(--gray-50);
    }

    .brand-section {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .brand-icon img {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }

    .signup-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 0.5rem;
    }

    .signup-header p {
      color: var(--gray-600);
      font-weight: 500;
    }

    .subtitle {
      color: var(--primary);
      font-weight: 600;
    }

    .signup-form {
      padding: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 0.5rem;
    }

    .form-label i {
      color: var(--primary);
      font-size: 0.875rem;
    }

    .required::after {
      content: ' *';
      color: var(--error);
    }

    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--gray-300);
      border-radius: var(--radius-lg);
      font-size: 1rem;
      background: var(--white);
      color: var(--gray-800);
      transition: border-color 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-input::placeholder {
      color: var(--gray-400);
    }

    .form-input.valid {
      border-color: var(--success);
    }

    .form-input.invalid {
      border-color: var(--error);
    }

    .validation-message {
      font-size: 0.75rem;
      margin-top: 0.25rem;
      display: none;
    }

    .validation-message.show {
      display: block;
    }

    .validation-message.valid {
      color: var(--success);
    }

    .validation-message.invalid {
      color: var(--error);
    }

    .signup-button {
      width: 100%;
      padding: 1rem 1.5rem;
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: var(--radius-lg);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .signup-button:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .signup-button:disabled {
      background: var(--gray-400);
      cursor: not-allowed;
      transform: none;
    }

    .login-link {
      width: 100%;
      padding: 0.75rem 1rem;
      background: transparent;
      color: var(--gray-700);
      border: 2px solid var(--gray-300);
      border-radius: var(--radius-lg);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .login-link:hover {
      background: var(--gray-50);
      border-color: var(--gray-400);
    }

    .alert {
      padding: 1rem;
      border-radius: var(--radius-lg);
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      font-weight: 500;
      display: none;
      align-items: center;
      gap: 0.75rem;
    }

    .alert.show {
      display: flex;
    }

    .alert-error {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }

    .alert-success {
      background: #f0fdf4;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }

    .signup-footer {
      text-align: center;
      padding: 1.5rem 2rem;
      background: var(--gray-50);
      border-top: 1px solid var(--gray-200);
    }

    .back-link {
      color: var(--gray-600);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.875rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-lg);
      transition: all 0.2s ease;
    }

    .back-link:hover {
      color: var(--primary);
      background: rgba(37, 99, 235, 0.05);
    }

    .loading-spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 640px) {
      body { padding: 1rem; }
      .signup-header { padding: 1.5rem 1.5rem 1rem; }
      .signup-form { padding: 1.5rem; }
      .signup-header h1 { font-size: 1.25rem; }
    }
  </style>
</head>

<body>
  <div class="signup-container">
    <div class="signup-header">
      <div class="brand-section">
        <div class="brand-icon">
          <img src="logo.jpg" alt="Brain-O-Math Logo">
        </div>
        <div>
          <h1>Coordinator Registration</h1>
          <p>Register as the<span class="subtitle"> Brain-O-Math Coordinator</span>for your school to manage student participation.</p>
        </div>
      </div>
    </div>

    <div class="signup-form">
      <div id="alertContainer"></div>

      <form id="signupForm">
        <div class="form-group">
          <label class="form-label required" for="schoolName">
            <i class="fas fa-school"></i>
            School Name
          </label>
          <input type="text" id="schoolName" class="form-input" required 
                 placeholder="Enter your school name" minlength="3" autocomplete="organization">
          <div class="validation-message" id="schoolNameMsg"></div>
        </div>

        <div class="form-group">
          <label class="form-label required" for="schoolAddress">
            <i class="fas fa-map-marker-alt"></i>
            School Address
          </label>
          <input type="text" id="schoolAddress" class="form-input" required 
                 placeholder="Enter complete school address" minlength="10" autocomplete="street-address">
          <div class="validation-message" id="schoolAddressMsg"></div>
        </div>

        <div class="form-group">
          <label class="form-label required" for="coordinatorName">
            <i class="fas fa-user"></i>
            Coordinator Name
          </label>
          <input type="text" id="coordinatorName" class="form-input" required 
                 placeholder="Enter your full name" minlength="3" autocomplete="name">
          <div class="validation-message" id="coordinatorNameMsg"></div>
        </div>

        <div class="form-group">
          <label class="form-label required" for="coordinatorPhone">
            <i class="fas fa-phone"></i>
            Phone Number
          </label>
          <input type="tel" id="coordinatorPhone" class="form-input" required 
                 placeholder="10-digit mobile number" pattern="[0-9]{10}" maxlength="10" autocomplete="tel">
          <div class="validation-message" id="coordinatorPhoneMsg"></div>
        </div>

        <div class="form-group">
          <label class="form-label required" for="coordinatorEmail">
            <i class="fas fa-envelope"></i>
            Email Address
          </label>
          <input type="email" id="coordinatorEmail" class="form-input" required 
                 placeholder="Enter your email address" autocomplete="email">
          <div class="validation-message" id="coordinatorEmailMsg"></div>
        </div>

        <button type="submit" class="signup-button" id="signupBtn">
          <i class="fas fa-user-plus"></i>
          Create Account
        </button>

        <a href="coordinator-login.html" class="login-link">
          <i class="fas fa-sign-in-alt"></i>
          Already have an account? Login here
        </a>
      </form>
    </div>

    <div class="signup-footer">
      <a href="index.html" class="back-link">
        <i class="fas fa-arrow-left"></i>
        Back to Home Page
      </a>
    </div>
  </div>

  <script>
    // Simplified and optimized JavaScript
    const API = 'https://brain-o-math.onrender.com/api';

    //const API = location.origin.includes('localhost') ? 'https://brain-o-math-olympiad.onrender.com/api' : '/api';
    
    const signupForm = document.getElementById('signupForm');
    const signupBtn = document.getElementById('signupBtn');
    const alertContainer = document.getElementById('alertContainer');

    // Simple validation rules
    const validators = {
      schoolName: (val) => val.length >= 3 ? { valid: true } : { valid: false, msg: 'School name must be at least 3 characters' },
      schoolAddress: (val) => val.length >= 10 ? { valid: true } : { valid: false, msg: 'Address must be at least 10 characters' },
      coordinatorName: (val) => /^[A-Za-z\s]{3,}$/.test(val) ? { valid: true } : { valid: false, msg: 'Name must contain only letters (min 3 chars)' },
      coordinatorPhone: (val) => /^[0-9]{10}$/.test(val) ? { valid: true } : { valid: false, msg: 'Enter exactly 10 digits' },
      coordinatorEmail: (val) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val) ? { valid: true } : { valid: false, msg: 'Enter a valid email address' }
    };

    function showAlert(message, type) {
      const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
      const icon = type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
      
      alertContainer.innerHTML = `
        <div class="alert ${alertClass} show">
          <i class="${icon}"></i>
          <span>${message}</span>
        </div>
      `;

      if (type === 'success') {
        setTimeout(() => alertContainer.innerHTML = '', 4000);
      }
    }

    function validateField(fieldId) {
      const field = document.getElementById(fieldId);
      const value = field.value.trim();
      const validator = validators[fieldId];
      const msgElement = document.getElementById(fieldId + 'Msg');
      
      if (!validator || !value) {
        field.className = 'form-input';
        msgElement.className = 'validation-message';
        return value ? true : false;
      }

      const result = validator(value);
      field.className = result.valid ? 'form-input valid' : 'form-input invalid';
      
      if (result.msg) {
        msgElement.textContent = result.msg;
        msgElement.className = `validation-message show ${result.valid ? 'valid' : 'invalid'}`;
      } else {
        msgElement.className = 'validation-message';
      }

      return result.valid;
    }

    // Event listeners - simplified
    const fields = ['schoolName', 'schoolAddress', 'coordinatorName', 'coordinatorPhone', 'coordinatorEmail'];
    
    fields.forEach(fieldId => {
      const field = document.getElementById(fieldId);
      let timeout;

      field.addEventListener('input', () => {
        clearTimeout(timeout);
        timeout = setTimeout(() => validateField(fieldId), 300); // Debounced validation
      });

      field.addEventListener('blur', () => validateField(fieldId));
    });

    // Phone number formatting
    document.getElementById('coordinatorPhone').addEventListener('input', function(e) {
      this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
    });

    // Form submission
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Quick validation
      let isValid = true;
      const formData = {};

      fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        const value = field.value.trim();
        formData[fieldId] = value;
        
        if (!validateField(fieldId) || !value) {
          isValid = false;
        }
      });

      if (!isValid) {
        showAlert('Please fill all fields correctly', 'error');
        return;
      }

      // Submit
      signupBtn.disabled = true;
      signupBtn.innerHTML = '<span class="loading-spinner"></span> Creating Account...';

      try {
        const response = await fetch(`${API}/coordinator/signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (response.ok && data.success) {
          showAlert('Account created successfully! Redirecting to login...', 'success');
          signupBtn.innerHTML = '<i class="fas fa-check-circle"></i> Account Created!';
          signupBtn.style.background = 'var(--success)';
          
          setTimeout(() => window.location.href = 'coordinator-login.html', 2000);
        } else {
          showAlert(data.message || 'Registration failed. Please try again.', 'error');
          signupBtn.disabled = false;
          signupBtn.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
        }
      } catch (error) {
        showAlert('Network error. Please try again.', 'error');
        signupBtn.disabled = false;
        signupBtn.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
      }
    });

    // Check if already logged in
    if (localStorage.getItem('coordinatorToken')) {
      showAlert('Already logged in. Redirecting...', 'success');
      setTimeout(() => window.location.href = 'coordinator-dashboard.html', 1500);
    }
  </script>
</body>
</html>